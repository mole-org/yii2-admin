{"version":3,"sources":["site.yii.js","site.class.js","site.jquery.fn.js","site.app.js","site.actions.js","site.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"site.js","sourcesContent":["(function($) {\r\n  // Overwrite the yii init\r\n  'use strict';\r\n\r\n  var yii = window.yii\r\n  var pub = yii\r\n\r\n  yii.init = function () {\r\n      initCsrfHandler();\r\n      initScriptFilter();\r\n  }\r\n\r\n  function initCsrfHandler() {\r\n    // automatically send CSRF token for all AJAX requests\r\n    $.ajaxPrefilter(function (options, originalOptions, xhr) {\r\n      if (!options.crossDomain && pub.getCsrfParam()) {\r\n        xhr.setRequestHeader('X-CSRF-Token', pub.getCsrfToken());\r\n      }\r\n    });\r\n    pub.refreshCsrfToken();\r\n  }\r\n\r\n  function initDataMethods() {\r\n    var handler = function (event) {\r\n      var $this = $(this),\r\n        method = $this.data('method'),\r\n        message = $this.data('confirm');\r\n\r\n      if (method === undefined && message === undefined) {\r\n        return true;\r\n      }\r\n\r\n      if (message !== undefined) {\r\n        pub.confirm(message, function () {\r\n          pub.handleAction($this);\r\n        });\r\n      } else {\r\n        pub.handleAction($this);\r\n      }\r\n      event.stopImmediatePropagation();\r\n      return false;\r\n    };\r\n\r\n    // handle data-confirm and data-method for clickable and changeable elements\r\n    $(document).on('click.yii', pub.clickableSelector, handler)\r\n      .on('change.yii', pub.changeableSelector, handler);\r\n  }\r\n\r\n  function initScriptFilter() {\r\n    var hostInfo = location.protocol + '//' + location.host;\r\n    var loadedScripts = $('script[src]').map(function () {\r\n      return this.src.charAt(0) === '/' ? hostInfo + this.src : this.src;\r\n    }).toArray();\r\n    $.ajaxPrefilter('script', function (options, originalOptions, xhr) {\r\n      if (options.dataType == 'jsonp') {\r\n        return;\r\n      }\r\n      var url = options.url.charAt(0) === '/' ? hostInfo + options.url : options.url;\r\n      if ($.inArray(url, loadedScripts) === -1) {\r\n        loadedScripts.push(url);\r\n      } else {\r\n        var found = $.inArray(url, $.map(pub.reloadableScripts, function (script) {\r\n          return script.charAt(0) === '/' ? hostInfo + script : script;\r\n        })) !== -1;\r\n        if (!found) {\r\n          xhr.abort();\r\n        }\r\n      }\r\n    });\r\n  }\r\n})(jQuery);","(function($) {\r\n  'use strict';\r\n\r\n  var rcleanScript = /^\\s*<!(?:\\[CDATA\\[|--)|(?:\\]\\]|--)>\\s*$/g\r\n  var rscriptType = /^$|\\/(?:java|ecma)script/i\r\n  var rscriptTypeMasked = /^true\\/(.*)/\r\n\r\n  function InsertHtml(content) {\r\n    this.$content = $(content)\r\n    this.$scripts = null\r\n  }\r\n\r\n  InsertHtml.prototype = {\r\n\r\n    disableScript: function() {\r\n      this.$scripts = \r\n        this.$content.filter('script')\r\n          .add(this.$content.find('script'))\r\n          .each(function() {\r\n            this.type = (this.getAttribute('type') !== null) + \"/\" + this.type.replace('/', '|')\r\n          })\r\n\r\n      return this\r\n    },\r\n\r\n    enableScript: function(noDestroy) {\r\n      if (this.$scripts.length) {\r\n        this.$scripts.each(function() {\r\n            var match = rscriptTypeMasked.exec(this.type)\r\n\r\n            if (match) {\r\n              this.type = match[1].replace('|', '/')\r\n            } else {\r\n              this.removeAttribute('type')\r\n            }\r\n\r\n            if (rscriptType.test(this.type || '')) {\r\n              if (this.src) {\r\n                $._evalUrl(this.src)\r\n              } else {\r\n                $.globalEval(this.textContent.replace(rcleanScript, ''))\r\n              }\r\n            }\r\n        })\r\n      }\r\n\r\n      if (!noDestroy) {\r\n        this.destroy()\r\n      }\r\n\r\n      return this\r\n    },\r\n\r\n    getContent: function() {\r\n      return this.$content\r\n    },\r\n\r\n    destroy: function() {\r\n      this.$content = null\r\n      this.$scripts = null\r\n    }\r\n  }\r\n\r\n  window.InsertHtml = InsertHtml\r\n})(jQuery);","(function($) {\r\n  'use strict';\r\n\r\n  // Extend $.fn\r\n  $.support.animate = (function() {\r\n    var prefix = ['Webkit', 'Moz', 'O', 'webkit', 'moz', 'o', 'ms']\r\n    var myStyle = document.createElement('div').style\r\n    var i\r\n    for (i in prefix) {\r\n      if (myStyle[prefix[i] + 'AnimationName'] !== undefined) return true\r\n    }\r\n    return false\r\n  })()\r\n\r\n  if ($.support.animate) {\r\n    $.each('fadeInUp, fadeOutUp, fadeInDown, fadeOutDown'.split(/,\\s*/), function(i, name) {\r\n      $.fn[name] = function(done) {\r\n        this.each(function() {\r\n          var $this = $(this)\r\n          $this.removeClass(name).addClass('animated ' + name)\r\n            .one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function() {\r\n              $this.removeClass('animated ' + name)\r\n              $.isFunction(done) && done.apply(this)\r\n            })\r\n        })\r\n\r\n        return this\r\n      }\r\n    })\r\n  } else {\r\n    $.fn.fadeInUp = $.fn.fadeInDown = function(done) { return $.fn.fadeIn.call(this, done) }\r\n    $.fn.fadeOutUp = $.fn.fadeOutDown = function(done) { return $.fn.fadeOut.call(this, done) }\r\n  }\r\n\r\n  $.fn.findAll = function(selector) {\r\n    return this.filter(selector).add(this.find(selector))\r\n  }\r\n\r\n})(jQuery);","\r\n\r\n(function($) {\r\n  'use strict';\r\n\r\n  // window.App\r\n  var App = window.App || {}\r\n\r\n  var flat = function(obj, res) {\r\n    if (!res) {\r\n      res = []\r\n    }\r\n\r\n    if (typeof(obj) === 'object') {\r\n      var k\r\n      for (k in obj) {\r\n        if (obj.hasOwnProperty(k)) {\r\n          flat(obj[k], res)\r\n        }\r\n      }\r\n    } else {\r\n      res.push(obj)\r\n    }\r\n\r\n    return res\r\n  }\r\n\r\n  var msgContainer = '#js-messages'\r\n  var tplMessages = '#tpl-messages'\r\n  App._message = function(msg, type, time) {\r\n    if (!App._message.tpl) {\r\n      App._message.tpl = $(tplMessages).html()\r\n    }\r\n\r\n    var timeid = null\r\n    var $tpl = $(App.replace(App._message.tpl, {msg: flat(msg).join('<br/>'), type: type}))\r\n    var setTime = function() {\r\n      timeid = window.setTimeout(function() {\r\n        $tpl.find('.message-close').trigger('click')\r\n      }, (time || 5) * 1000)\r\n    }\r\n    var clearTime = function() {\r\n      timeid && window.clearTimeout(timeid) && (timeid = null)\r\n    }\r\n\r\n    $tpl.prependTo(msgContainer)\r\n      .fadeInDown()\r\n      .on('mouseover', clearTime)\r\n      .on('mouseout', setTime)\r\n      .find('.message-close')\r\n      .on('click', function() {\r\n        clearTime()\r\n        $tpl.fadeOutDown(function() { $tpl.remove() })\r\n      })\r\n\r\n    setTime()\r\n  }\r\n  App.info = function(msg, time) {\r\n    App._message(msg || 'Info', 'info', time)\r\n  }\r\n  App.warning = function(msg, time) {\r\n    App._message(msg || 'Warning', 'warning', time)\r\n  }\r\n  App.success = function(msg, time) {\r\n    App._message(msg || 'Success', 'success', time)\r\n  }\r\n  App.error = function(msg, time) {\r\n    App._message(msg || 'Error', 'error', time)\r\n  }\r\n  App.cleanMessages = function() {\r\n    $(msgContainer).find('.message-close').trigger('click')\r\n  }\r\n\r\n  App.dialog = function(options, target) {\r\n    if (!App.dialog.modal) {\r\n      App.dialog.modal = $('#dialog-modal').html()\r\n    }\r\n\r\n    var $dialog = $(App.dialog.modal)\r\n    var $dialogTitle = $dialog.find('.modal-title')\r\n    var $dialogBody = $dialog.find('.modal-body')\r\n\r\n    if (target) {\r\n      $dialog.data('@EVENT_TRIGGER@', target)\r\n    }\r\n\r\n    $.ajax(options)\r\n      .success(function(data, textStatus, jqXHR) {\r\n        var insert = new window.InsertHtml('<div>' + data + '</div>')\r\n        var $content = insert.getContent()\r\n        var title = ''\r\n\r\n        if ($content.first().data('title')) {\r\n          title = $content.first().data('title')\r\n        } else if ($content.find('title').length) {\r\n          title = $content.find('title').last().remove().text()\r\n        } \r\n\r\n        if (title) {\r\n          $dialogTitle.text(title)\r\n        }\r\n        \r\n        insert.disableScript()\r\n        $content.find('.breadcrumb').remove()\r\n\r\n        $dialog.off('shown.bs.modal').on('shown.bs.modal', function() { insert.enableScript() })\r\n        $dialog.off('hidden.bs.modal').on('hidden.bs.modal', function() { $dialog.remove() })\r\n        $dialogBody.html($content.children())\r\n        $dialog.modal()\r\n      })\r\n\r\n    return $dialog\r\n  }\r\n\r\n  App.confirm = function(message, ok) {\r\n    if (!App.confirm.$modal) {\r\n      App.confirm.$modal = $($('#confirm-modal').html())\r\n      App.confirm.$body = App.confirm.$modal.find('.modal-body > p')\r\n      App.confirm.$ok = App.confirm.$modal.find('.btn-primary')\r\n    }\r\n\r\n    var $dialog = App.confirm.$modal\r\n    var $dialogBody = App.confirm.$body\r\n    var $ok = App.confirm.$ok\r\n\r\n    $dialogBody.html(message)\r\n    $ok.off('click')\r\n    if ($.isFunction(ok)) {\r\n      $ok.on('click', ok)\r\n    }\r\n    $dialog.modal()\r\n\r\n    return $dialog\r\n  }\r\n\r\n  App.alert = function(message) {\r\n    if (!App.alert.$modal) {\r\n      App.alert.$modal = $($('#alert-modal').html())\r\n      App.alert.$body = App.alert.$modal.find('.modal-body > p')\r\n    }\r\n\r\n    var $dialog = App.alert.$modal\r\n    var $dialogBody = App.alert.$body\r\n    $dialogBody.html(message)\r\n    $dialog.modal()\r\n\r\n    return $dialog\r\n  }\r\n\r\n  App.replace = function(str, dict) {\r\n    var r = /\\$\\{([^\\}]+)\\}/g\r\n    \r\n    return str.replace(r, function($0, $1) {\r\n      return dict[$1] !== undefined ? dict[$1] : '' \r\n    })\r\n  }\r\n\r\n  window.App = App\r\n})(jQuery);","\r\njQuery(function($) {\r\n  'use strict';\r\n\r\n  // Actions handle\r\n  var App = window.App\r\n  var handlers = App.actionHandlers = {}\r\n\r\n  $(document).on('click.App', '[data-action]', function(event) {\r\n    var $this = $(this)\r\n    var action = $this.data('action')\r\n\r\n    if ($.isFunction(App.actionHandlers[action])) {\r\n      return App.actionHandlers[action].apply(this, arguments)\r\n    } else {\r\n      event.stopImmediatePropagation()\r\n      event.preventDefault()\r\n      console.error(action + ' is not implement.')\r\n    }\r\n  })\r\n\r\n  handlers['get.modal'] = function(event) {\r\n    var $this = $(this)\r\n\r\n    App.dialog({\r\n      url: $this.attr('href'),\r\n      target: this\r\n    }, this)\r\n\r\n    if ($this.closest('.dropdown-menu').length) {\r\n      $(document).click()\r\n    } \r\n    \r\n    event.stopImmediatePropagation()\r\n    return false\r\n  }\r\n  \r\n  handlers['multi-delete.grid-view'] = function(event) {\r\n    var $this = $(this)\r\n    var $grid = $this.closest('.grid-view')\r\n    var $inputs = $grid.find('.pk > input:enabled:checked')\r\n    var pks = []\r\n\r\n    $inputs.each(function() { pks.push($(this).val()) })\r\n    if (!pks.length) {\r\n      App.alert('请选择记录。')\r\n    } else {\r\n      App.confirm(App.replace('确定删除这<b>${num}</b>条记录？', {'num': pks.length}), function() {\r\n        $.ajax({\r\n          url: $this.attr('href'),\r\n          type: 'POST',\r\n          data: {ids: pks}\r\n        }).done(function() {\r\n          $.pjax.reload()\r\n        })\r\n      })\r\n    }\r\n\r\n    event.stopImmediatePropagation()\r\n    return false\r\n  }\r\n\r\n  handlers['delete.grid-view'] = function(event) {\r\n    var $this = $(this)\r\n\r\n    App.confirm('确定删除这条记录？', function() {\r\n      $.ajax({\r\n        url: $this.attr('href'),\r\n        type: 'POST'\r\n      }).done(function() {\r\n        $.pjax.reload()\r\n      })\r\n    })\r\n\r\n    event.stopImmediatePropagation()\r\n    return false\r\n  }\r\n\r\n  var submitHandeler = function(event) {\r\n    var $this = $(this)\r\n    var data = $this.data('yiiActiveForm')\r\n\r\n    if (data.validated) {\r\n      if (this.tagName.toUpperCase() !== 'FORM') {\r\n        throw 'Submit requires a form element.'\r\n      }\r\n\r\n      var $modal = $this.closest('.modal')\r\n      var options = event.data && event.data || {}\r\n      var defaults = {\r\n        type: this.method.toUpperCase(),\r\n        url: this.action,\r\n        data: $this.serializeArray(),\r\n        target: this\r\n      }\r\n      $.ajax($.extend({}, defaults, options))\r\n    }\r\n    \r\n    event.stopImmediatePropagation()\r\n    return false\r\n  }\r\n  handlers['update.model-form'] = function(event) {\r\n    var $this = $(this)\r\n\r\n    if ($this.data('update.model-form')) {\r\n      return\r\n    } else {\r\n      $this.data('update.model-form', true)\r\n    }\r\n    \r\n    var $form = $this.closest('form')\r\n    var $modal = $form.closest('.modal')\r\n    var options = {}\r\n\r\n    if ($modal.length) {\r\n      var $eventTrigger = $($modal.data('@EVENT_TRIGGER@'))\r\n      if ($eventTrigger.closest('.grid-view').length) {\r\n        options['headers'] = {'Accept': 'text/grid'}\r\n        options['success'] = function(data, textStatus, jqXHR) {\r\n          var $tr = $eventTrigger.closest('tr')\r\n          $tr.replaceWith($('<div>' + data + '</div>').find('.grid-view tbody > tr'))\r\n          $modal.modal('hide')\r\n        }\r\n      } else {\r\n        options['success'] = function(data, textStatus, jqXHR) {\r\n          $modal.modal('hide')\r\n        }\r\n      }\r\n\r\n      $form.on('submit', options, submitHandeler)\r\n      event.stopImmediatePropagation()\r\n    }\r\n  }\r\n  handlers['create.model-form'] = function(event) {\r\n    var $this = $(this)\r\n\r\n    if ($this.data('create.model-form')) {\r\n      return\r\n    } else {\r\n      $this.data('create.model-form', true)\r\n    }\r\n\r\n    var $form = $this.closest('form')\r\n    var $modal = $form.closest('.modal')\r\n    var options = {}\r\n\r\n    if ($modal.length) {\r\n      var $eventTrigger = $($modal.data('@EVENT_TRIGGER@'))\r\n      if ($eventTrigger.closest('.grid-view').length) {\r\n        options['headers'] = {'Accept': 'text/grid'}\r\n        options['success'] = function(data, textStatus, jqXHR) {\r\n          var $tbody = $eventTrigger.closest('.grid-view').find('tbody:first')\r\n          $tbody.prepend($('<div>' + data + '</div>').find('.grid-view tbody > tr'))\r\n          $modal.modal('hide')\r\n        }\r\n      } else {\r\n        options['success'] = function(data, textStatus, jqXHR) {\r\n          $modal.modal('hide')\r\n        }\r\n      }\r\n\r\n      $form.on('submit', options, submitHandeler)\r\n      event.stopImmediatePropagation()\r\n    }\r\n  }\r\n});","(function($) {\r\n  'use strict';\r\n\r\n  var App = window.App\r\n  var pub = {\r\n    isActive: true,\r\n    init: function() {\r\n      initAjax()\r\n      initPjax()\r\n      initAjaxFileUpload()\r\n      initFixed()\r\n    }\r\n  }\r\n\r\n  function initAjax() {\r\n    $.ajaxPrefilter(function(options, originalOptions, jqXHR) {\r\n      jqXHR.$$handled = false\r\n      jqXHR.fail(function(jqXHR, textStatus, errorThrown) {\r\n        if (textStatus === 'error' && errorThrown === '') {\r\n          App.error('Can\\'t connect the server, please check you networks.')\r\n        } else if (textStatus === 'timeout') {\r\n          App.error('Request timeout')\r\n        } else if (textStatus === 'parsererror') {\r\n          console.error(errorThrown.stack)\r\n        } else if (jqXHR.status >= 301 && jqXHR.status <= 303) {\r\n          // Using pjax for redirect.\r\n          var url = jqXHR.getResponseHeader('X-Pjax-Url') || jqXHR.getResponseHeader('X-Redirect')\r\n          $.pjax({url: url})\r\n        } else if (jqXHR.status === 401) {\r\n          var $dialog = $($('#login-modal').html())\r\n          $dialog.modal()\r\n          $dialog.on('hidden.bs.modal', function() { $dialog.remove() })\r\n          $dialog.on('submit', 'form', function(event) {\r\n            var $this = $(this)\r\n            $.ajax({\r\n              type: this.method.toUpperCase(),\r\n              url: this.action,\r\n              data: $this.serializeArray(),\r\n              target: this\r\n            }).done(function() {\r\n              $dialog.modal('hide')\r\n            })\r\n\r\n            event.stopImmediatePropagation()\r\n            return false\r\n          })\r\n        } else if (jqXHR.status === 417) {\r\n          var message = jqXHR.responseText\r\n          try {\r\n            message = $.trim(message.substr(message.indexOf(':') + 1))\r\n            message = $.parseJSON(message)\r\n            App.error(message)\r\n          } catch(ex) { console.error(ex) }\r\n        } else {\r\n          App.error(jqXHR.responseText) \r\n        }\r\n\r\n        jqXHR.$$handled = true\r\n      })\r\n\r\n      if (options.target) {\r\n        var $target = $(options.target)\r\n        var count = $target.data('@JQ_AJAX_COUNT@') || 0\r\n        if (count > 0) {\r\n          jqXHR.abort()\r\n        } else {\r\n          $target.data('@JQ_AJAX_COUNT@', ++count)\r\n          jqXHR.always(function() {\r\n            $target.data('@JQ_AJAX_COUNT@', --count)\r\n          })\r\n        }\r\n      }\r\n    })\r\n\r\n    var ajaxLoading = '#ajax-loading'\r\n    var $ajaxLoading = $(ajaxLoading)\r\n    $(document).ajaxStart(function() {\r\n      $ajaxLoading.addClass('fullwidth')\r\n    })\r\n    $(document).ajaxStop(function() {\r\n      $ajaxLoading.removeClass('fullwidth')\r\n    })\r\n  }\r\n\r\n  var pjaxContainer = '#page-wrapper'\r\n  function initPjax() {\r\n    // Fixed for IE\r\n    if (!$.support.pjax) return\r\n\r\n    // Pjax default setting\r\n    $.pjax.defaults.timeout = 30 * 1000\r\n    $.pjax.defaults.isPjax = true\r\n    $.pjax.defaults.container = pjaxContainer\r\n\r\n\r\n    // Change the default behavior of PJAX for redirect handle.\r\n    $.ajaxPrefilter(function(options, originalOptions, jqXHR) {\r\n\r\n      if (options.isPjax) {\r\n        var error = options.error\r\n        options.error = function(xhr, textStatus, errorThrown) {\r\n          // TODO handle the error\r\n          //if ($.isFunction(error)) error.call(this, xhr, textStatus, errorThrown)\r\n        }\r\n\r\n        options.context.on('pjax:start', function() { App.cleanMessages() })\r\n      }\r\n    })\r\n\r\n    $(document).pjax('a', pjaxContainer)\r\n    $(document).on('submit', 'form', function(event) {\r\n      if ($(this).data('pjax')) {\r\n        $.pjax.submit(event, pjaxContainer)\r\n      }\r\n    })\r\n  }\r\n\r\n  function initAjaxFileUpload() {\r\n    $(document).on('change', '.btn-file :file', function() {\r\n      var $this = $(this)\r\n      var label = $this.val().replace(/\\\\/g, '/').replace(/.*\\//, '')\r\n      \r\n      $this.trigger('fileselect', [label])\r\n    })\r\n\r\n    $(document).on('fileselect', '.btn-file :file', function(event, label) {\r\n      var $this = $(this)\r\n      var $label = $this.data('label')\r\n\r\n      if (!$label) {\r\n        $label = $('<span />').insertAfter($this.parent())\r\n        $this.data('label', $label)\r\n      }\r\n      $label.text(label)\r\n    })\r\n\r\n    // Ajax file upload handler\r\n    // $.ajax({\r\n    //   url: this.action,\r\n    //   method: this.method || 'GET',\r\n    //   data: new FormData(this),\r\n    //   contentType: false,\r\n    //   processData: false,\r\n    //   cache: false\r\n    // })\r\n  }\r\n\r\n  function initFixed() {\r\n    $.fn.ready = function(fn) {\r\n    // Add the callback\r\n      var _fn = function() {\r\n        try {\r\n          fn.apply(this, arguments)\r\n        } catch (e) {\r\n          console.error(e)\r\n        }\r\n      }\r\n      $.ready.promise().done(_fn)\r\n\r\n      return this\r\n    };\r\n  }\r\n\r\n  $(document).ready(function () {\r\n    window.yii.initModule(pub)\r\n  })\r\n  \r\n})(jQuery);"],"sourceRoot":"/source/"}